{% extends "::base.html.twig" %}


{% block title %}Komentarai | Foodex{% endblock %}

{% block specific_scripts %}
    <script type="text/javascript">
    function loader(){
        scroll_content = new IScroll('#content_wrapper', {
            scrollbars: true,
            mouseWheel: true,
            interactiveScrollbars: true,
            shrinkScrollbars: 'scale',
            fadeScrollbars: true,
        });
        load_data();
        load_selects('Recipe', 'new_comment_recipe');
    }
    function key_check(event){}
    function admin_content(type){
        var admin_zone = "/admin_zone";
        show_loading_screen();
        location.href = admin_zone +"/" + type;
    }
    function admin_logout(){
        var formData = new FormData();
        formData.append('admin_logout', 'true');
        $.ajax({
            type: 'POST',
            url: '/ajax/admin_logout',
            data: formData,
            dataType: 'json',
            beforeSend: function () {
            },
            processData: false,
            contentType: false,
            success: function (data) {
                if (data.status == "good") {
                    location.href = "/admin_zone";
                }
            }
        });
    }
    function new_data(){
        var formData = get_new_data();
        $.ajax({
            type: 'POST',
            url: '/ajax/admin_new_data',
            data: formData,
            dataType: 'json',
            beforeSend:function(){
            },
            processData: false,
            contentType: false,
            success:function(data){
                if(data.status == "good"){
                    reset_forms();
                    toast(new_toast, 'good', 'logo');
                    var inserted_data = data.inserted_data;
                    $("#data_container").prepend(inserted_data);
                    setTimeout(function(){scroll_content.refresh()},0);
                }else{
                    toast('Įvyko klaida','bad','logo');
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {
                toast('Įvyko klaida. Perkraukite puslapį','bad','logo');
                console.log(xhr.responseText)
            }
        });
    }
    function save_data(id){
        var formData = get_save_data(id);
        $.ajax({
            type: 'POST',
            url: '/ajax/admin_save_data',
            data: formData,
            dataType: 'json',
            beforeSend:function(){
            },
            processData: false,
            contentType: false,
            success:function(data){
                if(data.status == "good"){
                    toast(save_toast,'good','logo');
                }else{
                    toast('Įvyko klaida','bad','logo');
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {
                toast('Įvyko klaida. Perkraukite puslapį','bad','logo');
            }
        });
    }
    function delete_data(id){
        var formData = new FormData();
        formData.append('id', id);
        formData.append('data_type', data_type);
        $.ajax({
            type: 'POST',
            url: '/ajax/admin_delete_data',
            data: formData,
            dataType: 'json',
            beforeSend:function(){
            },
            processData: false,
            contentType: false,
            success:function(data){
                if(data.status == "good"){
                    $("#data_" + id).remove();
                    setTimeout(function(){scroll_content.refresh()},0);
                    toast(delete_toast, 'good', 'logo');
                }else{
                    toast('Įvyko klaida','bad','logo');
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {
                toast('Įvyko klaida. Perkraukite puslapį','bad','logo');
            }
        });
    }
    function load_data(){
        var formData = new FormData();
        formData.append('data_type', data_type);
        $.ajax({
            type: 'POST',
            url: '/ajax/admin_load_data',
            data: formData,
            dataType: 'json',
            beforeSend:function(){
            },
            processData: false,
            contentType: false,
            success:function(data){
                if(data.status == "good"){
                    for(i = 0; i < data.loaded_data.length; i++){
                        $("#data_container").append(data.loaded_data[i]);
                    }
                }else{
                    toast('Įvyko klaida','bad','logo');
                }
                setTimeout(function(){scroll_content.refresh();},0);
                hide_loading_screen();

            },
            error: function (xhr, ajaxOptions, thrownError) {
                toast('Įvyko klaida. Perkraukite puslapį','bad','logo');
            }
        });
    }

    var data_type = "Comment";
    var new_toast = "Komentaras sukurtas";
    var save_toast = "Komentaras išsaugotas";
    var delete_toast = "Komentaras ištrintas";
    //changeable functions
    function get_new_data(){
        //default data
        var formData = new FormData();
        formData.append('data_type', data_type);

        //get data
        var text = $("#new_comment_text").val();
        var recipe_id = $("#new_recipe_id").val();

        //set data
        formData.append('text', text);
        formData.append('recipe_id', recipe_id);

        return formData;
    }

    function get_save_data(id){
        //default data
        var formData = new FormData();
        formData.append('id', id);
        formData.append('data_type', data_type);

        //get data
        var text = $("#data_" + id + " #input_text").val();
        var user_id = $("#data_" + id + " #input_user").val();
        var recipe_Id = $("#data_" + id + " #input_recipe").val();

        //set data
        formData.append('text', text);
        formData.append('user_id', user_id);
        formData.append('recipe_id', user_id);

        return formData;
    }

    function reset_forms(){
        $("#new_comment_text").val('');
        document.getElementById("new_recipe_id").selectedIndex = 0;
    }

    function load_selects(select_type, select_id){
        var formData = new FormData();
        formData.append('select_type', select_type);
        $.ajax({
            type: 'POST',
            url: '/ajax/admin_load_selects',
            data: formData,
            dataType: 'json',
            beforeSend:function(){
            },
            processData: false,
            contentType: false,
            success:function(data){
                if(data.status == "good"){
                    for(i = 0; i < data.select_data.length; i++){

                        $("#" + select_id).append(data.select_data[i]);
                    }
                }else{
                    toast('Įvyko klaida','bad','logo');
                }
                setTimeout(function(){scroll_content.refresh();},0);
            },
            error: function (xhr, ajaxOptions, thrownError) {
                toast('Įvyko klaida. Perkraukite puslapį','bad','logo');
                console.log(xhr.responseText)
            }
        });
    }

    </script>

{% endblock %}

{% block specific_styles %}
    <style type="text/css">
        #content_wrapper{
            left:0px;
            padding-bottom:10px;
            background-image:url('/images/content_background.jpg');
        }

        #scroller_content_admin{
            padding-bottom:10px;
            right:30px;
            left:0px;
        }

        .line_box{
            float:left;
            text-align: center;
            height:40px;
            line-height:45px;
            text-align: center;
            padding-left:0px;
            padding-right:0px;
            width:150px;
        }

        .line_box:hover {
            background-color: rgba(238, 238, 238, 1);
            height: 40px;
            border-bottom: 6px solid #D5D5D5;
        }

        .active_line_box{
            background-color: rgba(238, 238, 238, 1);
            height: 40px;
            border-bottom: 6px solid #D5D5D5;
        }


        #profile_cover{
            height:100px;
        }

        #profile_image{
            height:50px;
            width:50px;
            margin-top:25px;
            margin-bottom:25px;
            background-image:url('/images/logo.png');
        }

        #profile_name{
            height: 100px;
            line-height: 100px;
        }

        #admin_content{
            width:622px;
            height:auto;
            padding:10px;
            float:left;
        }

        .sub_add{
            float:right;
            margin-bottom:10px;
        }

        #data_container{
            float:left;
        }
    </style>

{% endblock %}

{% block header_lock %}{% endblock %}
{% block sidebar %}{% endblock %}
{% block filters_zone %}{% endblock %}
{% block config_zone %}{% endblock %}

{% block content %}
    <div id="content_wrapper">
        <div class="scroller" id="scroller_content_admin" >
            <div id="profile_cover">
                <div id="profile_image"></div>
                <div id="profile_name">Komentarai | Foodex</div>
            </div>
            <div id="profile_line">
                <div class="line_box transition" onclick="admin_content('users')">Vartotojai</div>
                <div class="line_box transition" onclick="admin_content('recipes')">Receptai</div>
                <div class="line_box transition" onclick="admin_content('locations')">Vietos</div>
                <div class="line_box transition" onclick="admin_content('facts')">Faktai</div>
                <div class="line_box transition" onclick="admin_content('filters')">Filtrai</div>
                <div class="line_box transition" onclick="admin_content('ingredients')">Ingredientai</div>
                <div class="line_box transition active_line_box" onclick="admin_content('comments')">Komentarai</div>
                <div class="line_box transition" onclick="admin_content('options')">Nustatymai</div>
                <div class="line_box transition" style="float:right;" onclick="admin_logout()">Atsijungti</div>
            </div>

            <div id="admin_content">
                <div class="sub_title">Pridėti naują</div>

                <div class="input_title">Komentaras</div><textarea type='text' style="width:440px;" class='new_recipe_textarea' id="new_comment_text" placeholder='Komentaras'></textarea>
                <div class="input_title">Receptas</div><select class='new_recipe_select' style="width:452px;" id="new_comment_recipe"></select>

                <div id="save_new_recipe_button" onclick="new_data()">Pridėti</div>
                <div class="sub_title">Duomenys</div>
                <div id="data_container"></div>
            </div>
        </div>
    </div>
{% endblock %}

